{
    "sourceFile": "main.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1767793546326,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767795002648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n   return v\r\n }\r\n \r\n async function clickupFetch(method, url, body) {\r\n-  const token = mustEnv('CLICKUP_TOKEN') // ClickUp: Authorization: {personal_token} :contentReference[oaicite:5]{index=5}\r\n+  const token = mustEnv('CLICKUP_TOKEN') // ClickUp: Authorization: {personal_token}\r\n \r\n   const res = await fetch(url, {\r\n     method,\r\n     headers: {\r\n@@ -57,15 +57,15 @@\n async function toggleClickupTimer() {\r\n   const teamId = mustEnv('CLICKUP_TEAM_ID')\r\n \r\n   // 1) Is something currently tracking?\r\n-  // GET /team/{team_id}/time_entries/current :contentReference[oaicite:6]{index=6}\r\n+  // GET /team/{team_id}/time_entries/current\r\n   const current = await clickupFetch('GET', `${BASE}/team/${teamId}/time_entries/current`)\r\n   const running = current?.data?.id != null\r\n \r\n   if (running) {\r\n     // 2a) Stop timer\r\n-    // POST /team/{team_id}/time_entries/stop :contentReference[oaicite:7]{index=7}\r\n+    // POST /team/{team_id}/time_entries/stop\r\n     const stopped = await clickupFetch('POST', `${BASE}/team/${teamId}/time_entries/stop`)\r\n \r\n     return {\r\n       action: 'stopped',\r\n@@ -74,9 +74,9 @@\n     }\r\n   }\r\n \r\n   // 2b) Nothing running → pick last task-backed time entry and start it\r\n-  // GET /team/{team_id}/time_entries (defaults to last 30 days for auth user) :contentReference[oaicite:8]{index=8}\r\n+  // GET /team/{team_id}/time_entries (defaults to last 30 days for auth user)\r\n   const now = Date.now()\r\n   const start30d = now - 30 * 24 * 60 * 60 * 1000\r\n \r\n   const list = await clickupFetch('GET', `${BASE}/team/${teamId}/time_entries?start_date=${start30d}&end_date=${now}`)\r\n@@ -91,9 +91,9 @@\n   candidates.sort((a, b) => parseStartMs(b) - parseStartMs(a))\r\n   const last = candidates[0]\r\n   const tid = taskId(last)\r\n \r\n-  // POST /team/{team_id}/time_entries/start with {\"tid\": \"<task_id>\"} :contentReference[oaicite:9]{index=9}\r\n+  // POST /team/{team_id}/time_entries/start with {\"tid\": \"<task_id>\"}\r\n   const started = await clickupFetch('POST', `${BASE}/team/${teamId}/time_entries/start`, { tid })\r\n \r\n   return {\r\n     action: 'started',\r\n@@ -119,14 +119,14 @@\n \r\n app.whenReady().then(() => {\r\n   createWindow()\r\n \r\n-  // IPC handler (renderer -> main) :contentReference[oaicite:10]{index=10}\r\n+  // IPC handler (renderer -> main)\r\n   ipcMain.handle('clickup:toggleTimer', async () => {\r\n     return await toggleClickupTimer()\r\n   })\r\n \r\n-  // Global hotkey (main process) :contentReference[oaicite:11]{index=11}\r\n+  // Global hotkey (main process)\r\n   const ok = globalShortcut.register('CommandOrControl+Shift+T', async () => {\r\n     try {\r\n       const r = await toggleClickupTimer()\r\n       win?.webContents?.send('clickup:status', r)\r\n"
                },
                {
                    "date": 1767795480568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -125,9 +125,9 @@\n     return await toggleClickupTimer()\r\n   })\r\n \r\n   // Global hotkey (main process)\r\n-  const ok = globalShortcut.register('CommandOrControl+Shift+T', async () => {\r\n+  const ok = globalShortcut.register('CommandOrControl+Insert', async () => {\r\n     try {\r\n       const r = await toggleClickupTimer()\r\n       win?.webContents?.send('clickup:status', r)\r\n     } catch (e) {\r\n"
                },
                {
                    "date": 1767795586254,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -125,9 +125,9 @@\n     return await toggleClickupTimer()\r\n   })\r\n \r\n   // Global hotkey (main process)\r\n-  const ok = globalShortcut.register('CommandOrControl+Insert', async () => {\r\n+  const ok = globalShortcut.register('CommandOrControl+num0', async () => {\r\n     try {\r\n       const r = await toggleClickupTimer()\r\n       win?.webContents?.send('clickup:status', r)\r\n     } catch (e) {\r\n"
                },
                {
                    "date": 1767795613274,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -125,9 +125,9 @@\n     return await toggleClickupTimer()\r\n   })\r\n \r\n   // Global hotkey (main process)\r\n-  const ok = globalShortcut.register('CommandOrControl+num0', async () => {\r\n+  const ok = globalShortcut.register('CommandOrControl+Shift+T', async () => {\r\n     try {\r\n       const r = await toggleClickupTimer()\r\n       win?.webContents?.send('clickup:status', r)\r\n     } catch (e) {\r\n"
                },
                {
                    "date": 1767795709886,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -125,9 +125,9 @@\n     return await toggleClickupTimer()\r\n   })\r\n \r\n   // Global hotkey (main process)\r\n-  const ok = globalShortcut.register('CommandOrControl+Insert', async () => {\r\n+  const ok = globalShortcut.register('CommandOrControl+Shift+Alt+t', async () => {\r\n     try {\r\n       const r = await toggleClickupTimer()\r\n       win?.webContents?.send('clickup:status', r)\r\n     } catch (e) {\r\n"
                },
                {
                    "date": 1767800567862,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,50 @@\n const { app, BrowserWindow, ipcMain, globalShortcut } = require('electron/main')\r\n const path = require('node:path')\r\n \r\n+const { app, BrowserWindow, Tray, nativeImage } = require('electron')\r\n+const path = require('node:path')\r\n+\r\n+let tray\r\n+\r\n+function img(p) {\r\n+  // NativeImage can be created from a path (png/jpg/etc). :contentReference[oaicite:3]{index=3}\r\n+  return nativeImage.createFromPath(p)\r\n+}\r\n+\r\n+// Put these files somewhere you ship with the app, e.g. ./assets/\r\n+const ICON_IDLE_32 = path.join(__dirname, 'assets', 'tray-idle.png')\r\n+const ICON_RUN_32 = path.join(__dirname, 'assets', 'tray-running.png')\r\n+const OVERLAY_IDLE_16 = path.join(__dirname, 'assets', 'overlay-idle-16.png')\r\n+const OVERLAY_RUN_16 = path.join(__dirname, 'assets', 'overlay-running-16.png')\r\n+\r\n+function ensureTray() {\r\n+  if (tray) return\r\n+  tray = new Tray(ICON_IDLE_32)\r\n+}\r\n+\r\n+function setTimerIndicators({ running }, win) {\r\n+  ensureTray()\r\n+\r\n+  // 1) Tray icon (cross-platform)\r\n+  // tray.setImage(image) updates the tray icon. :contentReference[oaicite:4]{index=4}\r\n+  tray.setImage(running ? ICON_RUN_32 : ICON_IDLE_32)\r\n+\r\n+  // 2) Windows taskbar overlay badge (Windows only)\r\n+  // win.setOverlayIcon(overlay, description) :contentReference[oaicite:5]{index=5}\r\n+  if (process.platform === 'win32' && win) {\r\n+    const overlay = running ? img(OVERLAY_RUN_16) : null // null clears overlay :contentReference[oaicite:6]{index=6}\r\n+    win.setOverlayIcon(overlay, running ? 'Timer running' : 'Timer stopped')\r\n+  }\r\n+\r\n+  // 3) macOS Dock icon (macOS only)\r\n+  // app.dock.setIcon(image) :contentReference[oaicite:7]{index=7}\r\n+  if (process.platform === 'darwin') {\r\n+    app.dock.setIcon(running ? ICON_RUN_32 : ICON_IDLE_32)\r\n+  }\r\n+}\r\n+\r\n+\r\n const BASE = 'https://api.clickup.com/api/v2'\r\n \r\n function mustEnv(name) {\r\n   const v = (process.env[name] || '').trim()\r\n"
                }
            ],
            "date": 1767793546326,
            "name": "Commit-0",
            "content": "const { app, BrowserWindow, ipcMain, globalShortcut } = require('electron/main')\r\nconst path = require('node:path')\r\n\r\nconst BASE = 'https://api.clickup.com/api/v2'\r\n\r\nfunction mustEnv(name) {\r\n  const v = (process.env[name] || '').trim()\r\n  if (!v) throw new Error(`Missing env var: ${name}`)\r\n  return v\r\n}\r\n\r\nasync function clickupFetch(method, url, body) {\r\n  const token = mustEnv('CLICKUP_TOKEN') // ClickUp: Authorization: {personal_token} :contentReference[oaicite:5]{index=5}\r\n\r\n  const res = await fetch(url, {\r\n    method,\r\n    headers: {\r\n      Authorization: token,\r\n      Accept: 'application/json',\r\n      ...(body ? { 'Content-Type': 'application/json' } : {}),\r\n    },\r\n    body: body ? JSON.stringify(body) : undefined,\r\n  })\r\n\r\n  const text = await res.text()\r\n  let json = null\r\n  try {\r\n    json = text ? JSON.parse(text) : null\r\n  } catch {\r\n    /* leave json null */\r\n  }\r\n\r\n  if (!res.ok) {\r\n    const msg = json ? JSON.stringify(json) : text\r\n    throw new Error(`HTTP ${res.status} ${method} ${url}\\n${msg}`)\r\n  }\r\n  return json\r\n}\r\n\r\nfunction parseStartMs(entry) {\r\n  const v = entry?.start\r\n  if (typeof v === 'number') return v\r\n  if (typeof v === 'string' && /^\\d+$/.test(v)) return Number(v)\r\n  return 0\r\n}\r\n\r\nfunction taskId(entry) {\r\n  const tid = entry?.task?.id\r\n  return typeof tid === 'string' && tid.trim() ? tid.trim() : null\r\n}\r\n\r\nfunction taskName(entry) {\r\n  const name = entry?.task?.name\r\n  return typeof name === 'string' && name.trim() ? name.trim() : null\r\n}\r\n\r\nasync function toggleClickupTimer() {\r\n  const teamId = mustEnv('CLICKUP_TEAM_ID')\r\n\r\n  // 1) Is something currently tracking?\r\n  // GET /team/{team_id}/time_entries/current :contentReference[oaicite:6]{index=6}\r\n  const current = await clickupFetch('GET', `${BASE}/team/${teamId}/time_entries/current`)\r\n  const running = current?.data?.id != null\r\n\r\n  if (running) {\r\n    // 2a) Stop timer\r\n    // POST /team/{team_id}/time_entries/stop :contentReference[oaicite:7]{index=7}\r\n    const stopped = await clickupFetch('POST', `${BASE}/team/${teamId}/time_entries/stop`)\r\n\r\n    return {\r\n      action: 'stopped',\r\n      task_id: taskId(stopped?.data) ?? null,\r\n      task_name: taskName(stopped?.data) ?? null,\r\n    }\r\n  }\r\n\r\n  // 2b) Nothing running → pick last task-backed time entry and start it\r\n  // GET /team/{team_id}/time_entries (defaults to last 30 days for auth user) :contentReference[oaicite:8]{index=8}\r\n  const now = Date.now()\r\n  const start30d = now - 30 * 24 * 60 * 60 * 1000\r\n\r\n  const list = await clickupFetch('GET', `${BASE}/team/${teamId}/time_entries?start_date=${start30d}&end_date=${now}`)\r\n\r\n  const entries = Array.isArray(list?.data) ? list.data : []\r\n  const candidates = entries.filter((e) => taskId(e))\r\n\r\n  if (!candidates.length) {\r\n    return { action: 'error', task_id: null, task_name: 'No recent task-backed time entries found' }\r\n  }\r\n\r\n  candidates.sort((a, b) => parseStartMs(b) - parseStartMs(a))\r\n  const last = candidates[0]\r\n  const tid = taskId(last)\r\n\r\n  // POST /team/{team_id}/time_entries/start with {\"tid\": \"<task_id>\"} :contentReference[oaicite:9]{index=9}\r\n  const started = await clickupFetch('POST', `${BASE}/team/${teamId}/time_entries/start`, { tid })\r\n\r\n  return {\r\n    action: 'started',\r\n    task_id: taskId(started?.data) ?? tid,\r\n    task_name: taskName(started?.data) ?? taskName(last) ?? null,\r\n  }\r\n}\r\n\r\nlet win\r\n\r\nfunction createWindow() {\r\n  win = new BrowserWindow({\r\n    width: 420,\r\n    height: 220,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.js'),\r\n      contextIsolation: true,\r\n    },\r\n  })\r\n\r\n  win.loadFile('index.html')\r\n}\r\n\r\napp.whenReady().then(() => {\r\n  createWindow()\r\n\r\n  // IPC handler (renderer -> main) :contentReference[oaicite:10]{index=10}\r\n  ipcMain.handle('clickup:toggleTimer', async () => {\r\n    return await toggleClickupTimer()\r\n  })\r\n\r\n  // Global hotkey (main process) :contentReference[oaicite:11]{index=11}\r\n  const ok = globalShortcut.register('CommandOrControl+Shift+T', async () => {\r\n    try {\r\n      const r = await toggleClickupTimer()\r\n      win?.webContents?.send('clickup:status', r)\r\n    } catch (e) {\r\n      win?.webContents?.send('clickup:status', { action: 'error', task_name: String(e?.message || e) })\r\n    }\r\n  })\r\n\r\n  if (!ok) {\r\n    win?.webContents?.send('clickup:status', { action: 'error', task_name: 'globalShortcut.register failed' })\r\n  }\r\n})\r\n\r\napp.on('will-quit', () => {\r\n  globalShortcut.unregisterAll()\r\n})\r\n"
        }
    ]
}